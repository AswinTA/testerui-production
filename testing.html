<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>popup</title>
</head>

<body>

    <div>
        <h5>Checking Login Token</h5>
        <div id="response-data">

        </div>
    </div>




    <script>
        window.onload = () => {
            console.log("after window onload");
            let access_token = localStorage.getItem("access_token");
            console.log(access_token)
            if (access_token != null) {
                console.log(access_token)
                var bearer = 'Bearer ' + access_token;
                // let url = "https://heroku-spring-auth.herokuapp.com/viewAllCompanyParticipants";
                let url = "http://localhost:8080/viewAllCompanyParticipants";

                fetch(url, {
                    method: "GET",
                    headers: {
                        'Authorization': bearer,
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                    .then(data => {
                        console.log(data)

                        let resDiv = document.createElement("div")
                        data.forEach(element => {
                            let li1 = document.createElement("li")
                            let cdiv = document.createElement("div")
                            li.innerText = element.userId;
                            let li2 = document.createElement("li").innerText = element.emailId;
                            let li3 = document.createElement("li").innerText = element.companyId;
                            let li4 = document.createElement("li").innerText = element.role;
                            let li5 = document.createElement("li").innerText = element.userName;
                            cdiv.append(li1)
                            cdiv.append(li2)
                            cdiv.append(li3)
                            cdiv.append(li4)
                            cdiv.append(li5)

                            resDiv.appendChild(cdiv)
                        });
                        document.getElementById("response-data").innerText = resDiv;
                    })
            }

        }
        // let tokenCheck = setTimeout(() => {
        //     console.log(accessToken)
        // }, 300)
        // tokenCheck();

        // let tokenCheck = setTimeout(checkAccessTokenOnLocalStorage(), 300);
        // let accessToken = null;

        // function checkAccessTokenOnLocalStorage() {
        //     console.log("checking")
        //     let accessToken = localStorage.getItem("access_token");
        //     if (accessToken != null) {
        //         apiCalls();
        //         clearTimeout(tokenCheck);

        //     }
        // }
        // function apiCalls() {
        //     console.log("inside api call")
        //     if (accessToken != null) {
        //         console.log(accessToken)
        //         var bearer = 'Bearer ' + accessToken;
        //         // let url = "https://heroku-spring-auth.herokuapp.com/viewAllCompanyParticipants";
        //         let url = "http://localhost:8080/viewAllCompanyParticipants";
        //         fetch(url, {
        //             method: "GET",
        //             headers: {
        //                 'Authorization': bearer,
        //                 'Content-Type': 'application/json'
        //             }
        //         }).then(response => console.log(response.body))
        //     }
        // }
    </script>
</body>

</html>