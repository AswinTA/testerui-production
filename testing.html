<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>popup</title>
</head>

<body>

    <div>
        <h5>Checking Login Token</h5>
        <div id="response-data">

        </div>
    </div>




    <script>
        window.onload = () => {
            console.log("after window onload");
            let access_token = localStorage.getItem("access_token");
            console.log(access_token)
            if (access_token != null) {
                console.log(access_token)
                var bearer = 'Bearer ' + access_token;
                // let url = "https://heroku-spring-auth.herokuapp.com/viewAllCompanyParticipants";
                let url = "http://localhost:8080/viewAllCompanyParticipants";

                fetch(url, {
                    method: "GET",
                    headers: {
                        'Authorization': bearer,
                        'Content-Type': 'application/json'
                    }
                }).then(response =>{
                  
                    response.json()
                    console.log(response.json())
                })
                    
                    .then(data => {
                        console.log(data)
                        
                        let resDiv = document.createElement("div")
                        data.forEach(element => {
                            let cdiv = document.createElement("div")
                            let obj = new Object();
                            obj.userId = element.userId;
                            obj.emailId = element.emailId;
                            obj.companyId = element.companyId;
                            obj.role = element.role;
                            obj.userName = element.userName;
                            let innerTxt = document.getElementById("response-data").innerText;
                            document.getElementById("response-data").innerText = innerTxt + JSON.stringify(obj)
                        });
                    }).catch(error=>{
                        console.log(error)
                    })
            }

        }
        // let tokenCheck = setTimeout(() => {
        //     console.log(accessToken)
        // }, 300)
        // tokenCheck();

        // let tokenCheck = setTimeout(checkAccessTokenOnLocalStorage(), 300);
        // let accessToken = null;

        // function checkAccessTokenOnLocalStorage() {
        //     console.log("checking")
        //     let accessToken = localStorage.getItem("access_token");
        //     if (accessToken != null) {
        //         apiCalls();
        //         clearTimeout(tokenCheck);

        //     }
        // }
        // function apiCalls() {
        //     console.log("inside api call")
        //     if (accessToken != null) {
        //         console.log(accessToken)
        //         var bearer = 'Bearer ' + accessToken;
        //         // let url = "https://heroku-spring-auth.herokuapp.com/viewAllCompanyParticipants";
        //         let url = "http://localhost:8080/viewAllCompanyParticipants";
        //         fetch(url, {
        //             method: "GET",
        //             headers: {
        //                 'Authorization': bearer,
        //                 'Content-Type': 'application/json'
        //             }
        //         }).then(response => console.log(response.body))
        //     }
        // }
    </script>
</body>

</html>